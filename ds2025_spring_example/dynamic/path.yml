http:
  routers:

    # ---- FRONTEND ROUTER (CATCH-ALL) ----
    # NEW ROUTER for the frontend
    frontend-router:
      rule: "Host(`localhost`) && PathPrefix(`/`)"
      service: frontend
      entryPoints:
        - web

    # ---- USER ROUTER ----
    user-router:
      rule: "Host(`localhost`) && PathPrefix(`/api/person`)"
      service: user
      entryPoints:
        - web
      middlewares:
        - strip-api-prefix

    # ---- AUTH ROUTER ----
    auth-router:
      rule: "Host(`localhost`) && PathPrefix(`/api/auth`)"
      service: auth
      entryPoints:
        - web
      middlewares:
        - strip-api-prefix

    # ---- DEVICE ROUTER ----
    device-router:
      rule: "Host(`localhost`) && PathPrefix(`/api/device`)"
      service: device
      entryPoints:
        - web
      middlewares:
        - strip-api-prefix

    # ---- JWKs ROUTER ----
    jwks-router:
      rule: "Host(`localhost`) && PathPrefix(`/api/.well-known/jwks.json`)"
      service: auth
      entryPoints:
        - web
      middlewares:
        - strip-api-prefix

  middlewares:
    strip-api-prefix:
      stripPrefix:
        prefixes:
          - "/api"

  services:
    user:
      loadBalancer:
        servers:
          - url: "http://user:8080"

    auth:
      loadBalancer:
        servers:
          - url: "http://auth:8080"

    device:
      loadBalancer:
        servers:
          - url: "http://device:8080"

    frontend:
      loadBalancer:
        servers:
          # This assumes your frontend container serves on port 80 (e.g., Nginx)
          # Change this port if your frontend container uses a different one
          - url: "http://frontend:80"
